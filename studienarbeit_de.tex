%! TEX program = pdflatex
\documentclass[arbeit=studie,oneside,BCOR=12mm]{ArbeitRST}
\usepackage{amsmath} 
\hypersetup{
    unicode=false,          % non-Latin characters in Acrobat’s bookmarks
    pdftoolbar=true,        % show Acrobat’s toolbar?
    pdfmenubar=true,        % show Acrobat’s menu?
    pdffitwindow=false,     % window fit to page when opened
    pdfstartview={FitH},    % fits the width of the page to the window
    pdftitle={Verbessung der Spurerkennung und -verfolgung autonomer Modellfahrzeuge}, % title
    pdfauthor={James Vero Asghar},     % author
    pdfsubject={Subject},   % subject of the document
    pdfcreator={James Vero Asghar},   % creator of the document
    pdfproducer={Producer}, % producer of the document
    pdfkeywords={stanley controller} {sliding window method} {model cars}, % list of keywords
    pdfnewwindow=true,      % links in new window
    colorlinks=true,        % false: boxed links; true: colored links
    linkcolor=blue,         % color of internal links (change box color with linkbordercolor)
    citecolor=green,        % color of links to bibliography
    filecolor=magenta,      % color of file links
    urlcolor=cyan           % color of external links
}
\setlength{\parindent}{0ex}
\setlength{\parskip}{2ex}

% Entfernt die farbigen Markierungen - bitte Druckversion mit dieser Option kompilieren
%\hypersetup{hidelinks}

\begin{document}

% Titelseite
% ==========

% Name des Verfassers
\author{James Vero Asghar}

% Geburtsort
\geburtsort{Austin, Texas, Vereignete Staaten}

% Geburtsdatum
\geburtsdatum{3. Dezember 1997}

% Titel der Arbeit
\title{Verbesserung der Spurerkennung und -verfolgung autonomer Modellfahrzeuge}

% Untertitel
\subtitle{}

% Angabe der Betreuer
\betreuer{Dr.-Ing. Carsten Knoll}
\betreuer{M.Sc. Paul Auerbach}

% Datum der Einreichung
\date{2. Februar 2222}


% Zunächst für das Vorgeplänkel römische Seitenzahlen und einfacher Seitenstil
% ============================================================================
\pagenumbering{Roman}
\pagestyle{plain}


% Titelseite erstellen
\maketitle


% Selbstständigkeitserklärung
% ===========================

% Selbstständigkeitserklärung erstellen
\selbststaendigkeitserklaerung


% Kurzfassung / Abstract
% ======================
\kurzfassung{An dieser Stelle fügen Sie bitte eine deutsche Kurzfassung ein.}
{At the Connected Robotics Lab (CoRoLa) research group at the Barkhausen
Institut, a demonstration using remote controlled 2 axis vehicles was
developed. The demonstration is currently in use in order to model
communications between vehicles similar to an Internet of Things (IoT) network.

In order to better model the complexities of a real world system a nonlinear
control algorithm was introduced to the system in order to more accurately
control the vehicles. The Stanley Controller is a nonlinear controller
developed for use with the lateral control of 2 axis vehicles in mind. As input
to the controller, a fisheye camera was used to create images of road. These
images were then digitally processed to find the yellow line for the vehicles
to follow.}


% Inhaltsverzeichnis
% ==================
\tableofcontents

\chapter{Einführung}

\chapter{Regelalgorithmus}

\section{Stanley-Regler}

Der Stanley-Regler ist ein nichtlinearer Regelalgorithmus, der 2005 von der
Stanford University entwickelt wurde. Er wurde entwickelt, um ein zweiachsiges 
Fahrzeug zu steuern, wobei nur der Ausrichtung und der Querfehler des zu verfolgenden 
Weges verwendet werden. Für die Dauer dieser Arbeit wird jedoch nicht das 
kinematische Modell eines zweiachsigen Fahrzeugs verwendet, sondern ein Modell,
das auch die Dynamik des Lenkwinkels berücksichtigt.

Der Stanley-Regler ist ein Pfadfolgerregler im Gegensatz zu einem 
Trajektoriefolgerregler. Der Stanley-Regler ist als Querregler konzipiert, so 
dass das Fahrzeug auf der Bahn bleibt, aber keinen Einfluss auf die 
Geschwindigkeit hat, mit der es der Bahn folgt. Die Vorteile dieses Ansatzes 
liegen darin, dass die Geschwindigkeit des Fahrzeugs flexibel gewählt werden 
kann, so dass der Ingenieur, abgesehen von dynamischen Effekten, jede für 
seine Anwendung erforderliche Geschwindigkeit wählen kann.

Der Stanley-Regler wird durch die folgende Gleichung dargestellt:

\begin{equation}
    u = \theta - \theta_d + \arctan\left(\frac{ke_{fa}}{v}\right)
    \label{eq:Stanley-Regler}
\end{equation}

wobei $u$ das Ausgangssignal des Reglers, theta der aktuelle Ausrichtung des 
Fahrzeugs, $\theta_d$ der Ausrichtung des Pfads, $k$ ein Skalierungsfaktor, 
$v$ die Geschwindigkeit des 
Fahrzeugs und $e_{fa}$ der Spurabweichungswert vom Mittelpunkt der Vorderachse des 
Fahrzeugs zum Pfad ist.


Der Stanley-Regler besteht aus zwei Komponenten: eine Komponente h"andelt sich 
um den Abstand von dem Fahrzeug zu dem Pfad und die andere Komponente h"andelt
sich mit der Ableitung des Abstands oder genauer geschreiben, die Ausrichtung.

Die erste Komponente, die um den Abstand geht, steuert die Lenkwinkelstrecke des 
Fahrzeugs so, dass das Fahrzeug in der Richtung des Pfads je mehr lenkt, desto 
weiter 
das Fahrzeug von dem Pfad ist. Diese Komponente ist durch 
$\arctan\left(\frac{ke_V}{v}\right)$ dargestellt.

Die zweite Komponente steuert die Lenkwinkelstrecke so, dass sie parallel zu
dem Pfad bleibt. Diese Komponente ist durch $\theta - \theta_d$ dargestellt.

Zussamen arbeiten Komponenten miteinander, sodass das Fahrzeug auf den Pfad
kommt. 







\section{Simulation}


Um das Verhalten des Stanley-Reglers auf dem ferngesteuerten Fahrzeug zu 
untersuchen, wurde eine Simulation des Regelkreises verwendet.
Die Simulation besteht aus drei Hauptkomponenten: erstens die Bahn, der das 
Fahrzeug folgen muss, zweitens der Stanley-Regler und drittens das 
Fahrzeugmodell. Ein Differentialgleichungslöser wird verwendet, um die 
Zeitreihen des zweiachsigen Fahrzeugs zu analysieren. 

Der Pfad, dem das Fahrzeug folgen muss, ist eine virtuelle Version der realen 
Strecke, die das Fahrzeug benutzen wird. Eine visuelle Darstellung des Weges 
ist ABBILDUNG. In der Simulation wird der Weg durch die folgende kontinuierliche
statische Funktion dargestellt:
----, 
mit dem Eingang t und dem Ausgang (x, y, h). Diese Funktion wird dann für eine 
beliebige Anzahl von t-Werten diskretisiert, um ein Array von 
(x, y, theta)-Werten zu erstellen. Dieses Array wird dann in den 
Differentialgleichungslöser eingespeist, der den Stanley-Regler und das 
Fahrzeugmodell kapselt. 

Bei dem verwendeten Fahrzeugmodell handelt es sich um das Modell eines 
Hinterachsfahrzeugs. Dieses Modell wird durch die folgende nichtlineare 
Zustandsraumdarstellung dargestellt:
\begin{gather}
    \dot{x} = v \cos(\theta) \\
    \dot{y} = v \sin(\theta) \\
    \dot{\theta} = \frac{v}{l}\tan(\varphi) \\
    \dot{\varphi} = \frac{-1}{T}\left(\varphi - \delta\right).
\end{gather}
Die Zustandsvariablen des Modells sind $x_H$, $y_H$, $\phi$ und $\theta$, wobei
$x_H$ und $y_H$ die XY-Koordinaten des Mittelpunkts der Hinterachse sind und
$\theta$ der Kurs des Fahrzeugs ist. Die Eingangsvariablen des Modells sind $v$
und $\phi_d$, wobei $v$ die Geschwindigkeit des Fahrzeugs und $\phi$ der
Ausgang des Stanley-Reglers ist. Der Lenkwinkel $\phi$ wird durch eine lineare
Differentialgleichung erster Ordnung mit der konfigurierbaren Zeitkonstante $T$
dargestellt. Das Verhalten des Stanley-Reglers bei dynamischen Einflüssen auf
den Lenkwinkel ist von großer Bedeutung, da die globale asymptotische
Stabilität des Reglers nur für das kinematische Modell mit federndem Lenkwinkel
nachgewiesen wurde. 

Da der Stanley-Regler den Mittelpunkt der Vorderachse für den Querspurfehler 
benötigt, muss dieser aus der Hinterachse berechnet werden.
Der Mittelpunkt der Vorderachse wird über die folgende statische Funktion aus 
den Zustandsgrößen berechnet:
\begin{gather}
    \underline{p}_H := 
    \begin{bmatrix}
        x_H & y_H
    \end{bmatrix}^T \\
    \underline{p}_V := 
    \begin{bmatrix}
        x_V & y_V
    \end{bmatrix}^T
    \label{eq:Hinterradachse und Vorderradachse}
\end{gather}
\begin{equation}
    \underline{p}_V = \underline{p}_H + l 
    \begin{bmatrix}
        \cos(\theta + \pi/2) \\ 
        \sin(\theta + \pi/2),
    \end{bmatrix}
    \label{eq:Transformation von Hinterradachse zu Vorderradachse}
\end{equation}
wobei xf und yf die x/y-Koordinaten dieses Mittelpunkts sind. 

Wie bereits erwähnt, besteht der Stanley-Regler aus mehreren Teilen, die
berechnet werden müssen. Der Steuerkurs ist eine Zustandsvariable und daher 
immer verfügbar. Für den Kreuzspurfehler und den Kurs muss der richtige 
Bahnpunkt gewählt werden. Der Stanley-Regler verwendet den nächstgelegenen 
Bahnpunkt, um den erforderlichen Kurs und den aktuellen Querfehler zu bestimmen.
Für die Simulation wird dieser durch die Suche nach dem Punkt mit dem geringsten
Abstand zum Vorderachsmittelpunkt bestimmt. Der Algorithmus wird wie folgt 
dargestellt: 
---.
Durch diesen gefundenen Punkt wird der Kursweg bestimmt. Der 
Querabweichungsfehler wird dann durch die folgende Gleichung bestimmt:
---.
Diese Gleichung stellt das Skalarprodukt des Vektors senkrecht zum 
Steuerkursvektor und des Vektors von der Vorderachse zum Bahnpunkt dar. 
ABBILDUNG ist eine visuelle Darstellung dieser beiden Vektoren.
Der Kurs- und der Spurabweichungsvektor werden dann in den Stanley-Regler 
eingegeben, wobei der Ausgang des Reglers in das Fahrzeugmodell eingespeist 
wird. 

Da der Stanley-Regler nur einen Lenkwinkel ausgibt, wird die Geschwindigkeit als
konstant angenommen. 
Ein High-Level-Diagramm des Regelkreises ist in ABBILDUNG dargestellt.

Die Simulation wird dann für eine ausgewählte Zeitspanne durchgeführt.

    \begin{equation} 
        \underline{x} := 
        \begin{bmatrix}
            x_H & y_H & \theta
        \end{bmatrix}^T 
        \label{Zustandsvektor}
    \end{equation}




    \begin{gather}
        \underline{\nu} := 
        \begin{bmatrix}
            -\cos(\theta + \pi/2) \\
            -\sin(\theta + \pi/2)
        \end{bmatrix} \\
        \underline{p}_P := 
        \begin{bmatrix}
            x_P & y_P
        \end{bmatrix}^T
    \end{gather}

    \begin{equation}
        e_V :=  \underline{\nu} \cdot \min_i |\underline{p}_V -  \underline{p}_{Pi}| ?
        \label{eq:Querabweichung}
    \end{equation}

\chapter{Bildverarbeitung}
\section{Kamera-Kalibrierung}

\section{Color Thresholding}

\section{Perspective Transformation}
\section{Histogram}
\section{Gleit-Fenster-Verfahren}
\section{Berechnung von Ausrichtung und Abstand}
\section{Pipeline-Optimierungen}

\chapter{Experiment}
\section{Hardware Setup}
\section{Experiment Setup}


\chapter{Conclusion}
\end{document}
